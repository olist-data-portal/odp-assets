---
alwaysApply: true
---

# CI/CD開発規約

## ガイドライン

- **ドキュメント参照**: GitHub Actions公式ドキュメントを優先
- **CI/CDツール**: GitHub Actionsを使用
- **認証情報の管理**: CI/CD利用時に必要な認証情報はGitHub Secretsを使用

## 実装規約

- **CIワークフロー**: `feature-`で始まるブランチから`main`へのPull Requestが作成・更新されたときに実行
- **CDワークフロー（dev環境）**: `feature-`で始まるブランチがリモートにプッシュされたときに実行
  - Dockerイメージのビルドとプッシュを自動的に実行
- **CDワークフロー（prd環境）**: `main`ブランチにマージされたときに実行
  - Dockerイメージのビルドとプッシュを自動的に実行
- **Dockerイメージのビルド**: CI/CDで自動的に実行される（手動でのビルド・プッシュは不要）
- **Terraform CIワークフロー**: `feature-`で始まるブランチから`main`へのPull Requestが作成・更新されたときに実行
  - `gcp/**`ディレクトリの変更があった場合のみトリガー
  - Terraformのフォーマットチェック、バリデーション、プランを実行
- **Terraform CDワークフロー**: `main`ブランチにマージされたときに実行
  - `gcp/**`ディレクトリの変更があった場合のみトリガー
  - Terraformのプランと適用を実行
  - `environment: production`を設定し、リソース変更時に承認が必要

## 命名規約

- **ワークフローファイル名**: スネークケースを使用（例: `ci.yml`, `cd_dev.yml`, `cd_prd.yml`, `terraform_ci.yml`, `terraform_cd.yml`）

## セキュリティ

- **機密情報**: GitHub Secretsで管理（ハードコード禁止）
- **サービスアカウントキー**: 最小権限の原則に従い、必要最小限の権限のみを付与

## 品質

- **必要最小限のステップ**: 運用に必要十分な機能のみを保持し、過剰な実装は行わない
- **エラーハンドリング**: ステップが失敗した場合は、その時点でジョブを中止する（`fail-fast: true`を設定）

## 簡潔性

- **必要最小限の機能**: 過剰な実装は行わない
- **GitHub Secrets**: 必須項目のみ設定
  - `GCP_SA_KEY`: GCPサービスアカウントキー（JSON形式、Artifact Registry Writer権限）
  - `GCP_PROJECT_ID`: GCPプロジェクトID
  - `ARTIFACT_REGISTRY_REPOSITORY`: Artifact Registryリポジトリ名
  - `REGION`: GCPリージョン（例: `asia-northeast1`）
