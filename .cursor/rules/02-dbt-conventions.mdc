---
alwaysApply: true
---

# dbt開発規約

## ガイドライン

- **ドキュメント参照**: 対応するバージョンのdbt公式ドキュメントを優先
- **フォーマッター**: `sqlfmt`を使用
- **プロジェクト構成**: `models/`ディレクトリ配下に配置
  - `staging/`: ステージングモデル（Rawデータの軽い変換）
  - `intermediate/`: 中間モデル（複数モデルを結合・集約）
  - `warehouse/`: ウェアハウスモデル
  - `mart/`: マートモデル（最終的な分析用テーブル）

## 実装規約

- **依存関係**: モデル間の依存関係を適切に定義
- **SQLの明確性**: 複雑なロジックはコメントで説明する

## 命名規約

- **モデル名**: スネークケースを使用（例: `stg_api_data`, `int_user_events`, `mart_user_summary`）
- **プレフィックス**: モデルの種類に応じてプレフィックスを付与
  - `stg_`: ステージングモデル
  - `int_`: 中間モデル
  - `wh_`: ウェアハウスモデル
  - `mart_`: マートモデル
- **データセット名**: `odp-{env}-{ディレクトリ}`形式を使用（例: `odp-local-staging`, `odp-dev-mart`, `odp-prd-mart`）

## 環境ごとの設定

### local環境

- `profiles.yml`でローカル開発用の設定を定義
- BigQueryプロジェクトはprdと同じものを使用（データは共有）

### dev環境

- 環境変数またはSecret ManagerからBigQuery接続情報を取得
- `feature-`ブランチがリモートにプッシュされた時にCI/CDで反映

### prd環境

- 環境変数またはSecret ManagerからBigQuery接続情報を取得
- `main`ブランチにマージされた時にCI/CDで反映

## セキュリティ

- **接続情報**: BigQuery接続情報は環境変数またはSecret Managerから取得

## 品質

- **明確なSQL**: 複雑なロジックはコメントで説明する

## 簡潔性

- **必要最小限の機能**: 過剰な実装は行わない
- **余計なファイル**: 不要なファイル、未使用の変数、説明不要なコメントは削除する
